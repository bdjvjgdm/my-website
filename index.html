<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá Th·ªëng Qu·∫£n L√Ω ƒêi·ªÉm Thi ƒêua</title>
    <!-- T√≠ch h·ª£p Tailwind CSS ƒë·ªÉ l√†m ƒë·∫πp giao di·ªán -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- T·∫£i c√°c th∆∞ vi·ªán Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

    <!-- Kh·ªüi t·∫°o Firebase sau khi t·∫£i SDK -->
    <script>
        // C·∫•u h√¨nh Firebase ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t
        const firebaseConfig = {
            apiKey: "AIzaSyDaeedEmbpGg_rr2ln13lWsXKY-opoy36E",
            authDomain: "quanlydiem-c2820.firebaseapp.com",
            projectId: "quanlydiem-c2820",
            storageBucket: "quanlydiem-c2820.appspot.com",
            messagingSenderId: "912711399959",
            appId: "1:912711399959:web:08e5897d6b958c1371fa52"
        };

        // Kh·ªüi t·∫°o c√°c d·ªãch v·ª• Firebase
        firebase.initializeApp(firebaseConfig);
        window.db = firebase.firestore();
        window.auth = firebase.auth();
    </script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-image: url('https://images.unsplash.com/photo-1557682250-33bd709cbe85?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        .card { background-color: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
        .drop-zone { border: 2px dashed #cbd5e1; padding: 1rem; min-height: 150px; border-radius: 0.75rem; transition: background-color 0.2s, border-color 0.2s; }
        .drop-zone.drag-over { background-color: #f5f3ff; border-color: #7c3aed; }
        .student-card { cursor: grab; transition: transform 0.2s; }
        .student-card:active { cursor: grabbing; transform: scale(1.05); }
        .student-card.dragging { opacity: 0.5; }
    </style>
</head>
<body class="bg-gray-200">

    <div class="min-h-screen flex items-center justify-center p-4">

        <!-- Trang ƒêƒÉng Nh·∫≠p -->
        <div id="login-page" class="w-full max-w-md">
            <div class="card shadow-2xl rounded-2xl p-8 space-y-6">
                <div class="text-center">
                    <h1 class="text-3xl font-bold text-gray-800">ƒêƒÉng Nh·∫≠p H·ªá Th·ªëng</h1>
                    <p class="text-gray-600 mt-2">D√†nh cho c√°n b·ªô qu·∫£n l√Ω h·ªçc t·∫≠p</p>
                </div>
                 <div class="space-y-4">
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700">T√™n ƒëƒÉng nh·∫≠p (Email)</label>
                        <input type="email" id="email" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-violet-500 focus:border-violet-500" placeholder="v√≠ d·ª•: to1@app.com">
                    </div>
                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-700">M·∫≠t kh·∫©u</label>
                        <input type="password" id="password" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-violet-500 focus:border-violet-500" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                </div>
                <div id="login-error" class="text-red-500 text-sm text-center hidden">T√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u kh√¥ng h·ª£p l·ªá.</div>
                <button onclick="handleLogin()" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-lg text-sm font-bold text-white bg-violet-600 hover:bg-violet-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-violet-500 transition-transform transform hover:scale-105">
                    ƒêƒÉng Nh·∫≠p 
                </button>
            </div>
        </div>

        <!-- Trang Ch√≠nh - Qu·∫£n L√Ω -->
        <div id="main-page" class="hidden w-full max-w-6xl">
            <div class="card shadow-2xl rounded-2xl p-8 space-y-8">
                <div class="flex justify-between items-center flex-wrap gap-4">
                    <h1 class="text-3xl font-bold text-gray-800">Trang Qu·∫£n L√Ω Thi ƒêua</h1>
                    <div class="text-right">
                         <div id="user-info" class="text-sm font-medium text-gray-700"></div>
                         <button onclick="handleLogout()" class="text-sm font-medium text-violet-600 hover:text-violet-500">ƒêƒÉng xu·∫•t</button>
                    </div>
                </div>
                
                 <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-1 space-y-6">
                        <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
                            <h2 class="text-xl font-semibold text-gray-700 mb-4">1. Th√™m h·ªçc sinh</h2>
                            <div id="add-student-error" class="text-red-500 text-sm mb-2 hidden"></div>
                            <div class="flex flex-col sm:flex-row gap-4 items-end">
                                <div class="w-full">
                                    <label for="student-name" class="block text-sm font-medium text-gray-700">Nh·∫≠p t√™n h·ªçc sinh</label>
                                    <input type="text" id="student-name" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-violet-500 focus:border-violet-500" placeholder="v√≠ d·ª•: Nguy·ªÖn VƒÉn An">
                                </div>
                                <button onclick="addStudent()" class="w-full sm:w-auto whitespace-nowrap px-6 py-2 border border-transparent rounded-lg shadow-md text-sm font-bold text-white bg-violet-600 hover:bg-violet-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-violet-500">
                                    Th√™m
                                </button>
                            </div>
                        </div>
                        <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
                             <h2 class="text-xl font-semibold text-gray-700 mb-4">2. C·ªông ƒëi·ªÉm thi ƒëua</h2>
                             <div id="add-points-error" class="text-red-500 text-sm mb-2 hidden"></div>
                             <div class="grid grid-cols-1 gap-4 items-end">
                                <div>
                                    <label for="student-id" class="block text-sm font-medium text-gray-700">M√£ h·ªçc sinh</label>
                                    <input type="text" id="student-id" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-violet-500 focus:border-violet-500" placeholder="v√≠ d·ª•: HS1">
                                </div>
                                <div>
                                     <label for="points-to-add" class="block text-sm font-medium text-gray-700">S·ªë ƒëi·ªÉm c·ªông</label>
                                     <input type="number" id="points-to-add" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-violet-500 focus:border-violet-500" placeholder="v√≠ d·ª•: 10">
                                </div>
                                <button onclick="addPoints()" class="w-full px-6 py-2 border border-transparent rounded-lg shadow-md text-sm font-bold text-white bg-violet-600 hover:bg-violet-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-violet-500">
                                    Th√™m ƒêi·ªÉm
                                </button>
                             </div>
                        </div>
                    </div>
                    <div class="lg:col-span-2 space-y-6">
                        <h2 class="text-xl font-semibold text-gray-700">B·∫£ng ƒëi·ªÉm thi ƒëua</h2>
                        <div class="bg-white p-4 rounded-lg border">
                            <h3 class="font-semibold text-center mb-2 text-gray-600">Ch∆∞a x·∫øp t·ªï</h3>
                            <div id="unassigned-zone" data-groupid="0" class="drop-zone min-h-[100px]">
                                <p class="text-gray-400 text-sm text-center">K√©o h·ªçc sinh v√†o c√°c t·ªï b√™n d∆∞·ªõi</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                            <div id="group-1" data-groupid="1" class="drop-zone bg-white">
                                <h3 class="font-semibold text-center mb-2 text-gray-800">T·ªï 1</h3>
                            </div>
                            <div id="group-2" data-groupid="2" class="drop-zone bg-white">
                                <h3 class="font-semibold text-center mb-2 text-gray-800">T·ªï 2</h3>
                            </div>
                            <div id="group-3" data-groupid="3" class="drop-zone bg-white">
                                <h3 class="font-semibold text-center mb-2 text-gray-800">T·ªï 3</h3>
                            </div>
                             <div id="group-4" data-groupid="4" class="drop-zone bg-white">
                                <h3 class="font-semibold text-center mb-2 text-gray-800">T·ªï 4</h3>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="pt-6 border-t border-gray-200 text-center space-y-4">
                    <button onclick="showSummary()" class="w-full max-w-xs mx-auto py-3 px-4 border border-transparent rounded-lg shadow-lg text-sm font-bold text-gray-800 bg-yellow-400 hover:bg-yellow-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-400 transition-transform transform hover:scale-105">
                        T·ªïng K·∫øt Tu·∫ßn
                    </button>
                    <!-- N√∫t X√≥a D·ªØ Li·ªáu - Ch·ªâ d√†nh cho Admin -->
                    <button id="clear-data-button" onclick="openClearDataModal()" class="hidden w-full max-w-xs mx-auto py-3 px-4 border border-transparent rounded-lg shadow-lg text-sm font-bold text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-transform transform hover:scale-105">
                        X√≥a To√†n B·ªô D·ªØ Li·ªáu
                    </button>
                </div>
            </div>
        </div>

        <!-- Trang T·ªïng K·∫øt -->
        <div id="summary-page" class="hidden w-full max-w-2xl">
             <div class="card shadow-2xl rounded-2xl p-8 space-y-6">
                <h1 class="text-3xl font-bold text-center text-gray-800">B·∫£ng X·∫øp H·∫°ng Tu·∫ßn</h1>
                <p class="text-center text-gray-600">Top 10 h·ªçc sinh c√≥ ƒëi·ªÉm thi ƒëua cao nh·∫•t.</p>
                <div id="top-10-list-container" class="space-y-4"></div>
                <div class="text-center pt-4">
                     <button onclick="goBackToMain()" class="px-6 py-2 border border-transparent rounded-lg shadow-md text-sm font-bold text-white bg-gray-600 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                        Quay L·∫°i Trang Qu·∫£n L√Ω
                    </button>
                </div>
             </div>
        </div>
    </div>
    
    <!-- Modal X√°c nh·∫≠n X√≥a D·ªØ Li·ªáu -->
    <div id="clear-data-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50">
        <div class="relative mx-auto p-8 border w-full max-w-md shadow-lg rounded-2xl bg-white space-y-6">
            <div class="text-center">
                <h3 class="text-2xl font-bold text-gray-900">X√°c nh·∫≠n X√≥a D·ªØ Li·ªáu</h3>
                <div class="mt-4 px-7 py-3">
                    <p class="text-md text-gray-600">
                        B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a to√†n b·ªô d·ªØ li·ªáu c·ªßa t·∫•t c·∫£ h·ªçc sinh kh√¥ng?
                        <br>
                        <strong class="text-red-600">H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.</strong>
                    </p>
                </div>
                <div class="items-center px-4 py-3 space-x-4">
                    <button id="confirm-delete-btn" onclick="clearAllData()" class="px-6 py-2 bg-red-600 text-white text-base font-medium rounded-md w-auto shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500">
                        X√°c nh·∫≠n X√≥a
                    </button>
                    <button id="cancel-delete-btn" onclick="closeClearDataModal()" class="px-6 py-2 bg-gray-200 text-gray-800 text-base font-medium rounded-md w-auto shadow-sm hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400">
                        H·ªßy
                    </button>
                </div>
            </div>
        </div>
    </div>


    <script>
        // --- C·∫§U H√åNH V√Ä BI·∫æN TO√ÄN C·ª§C ---
        const predefinedUsers = {
            'to1@app.com': { role: 'T·ªï 1', groupId: 1 },
            'to2@app.com': { role: 'T·ªï 2', groupId: 2 },
            'to3@app.com': { role: 'T·ªï 3', groupId: 3 },
            'to4@app.com': { role: 'T·ªï 4', groupId: 4 },
            'admin@app.com': { role: 'ADMIN', groupId: null } // Admin c√≥ th·ªÉ qu·∫£n l√Ω t·∫•t c·∫£
        };
        
        let students = [];
        let unsubscribe; 
        let currentUserRole = null;
        let currentUserGroupId = null;
        
        const dataDocRef = () => db.collection("classes").doc("mainClass");

        const loginPage = document.getElementById('login-page');
        const mainPage = document.getElementById('main-page');
        const summaryPage = document.getElementById('summary-page');
        const loginError = document.getElementById('login-error');
        const addStudentError = document.getElementById('add-student-error');
        const addPointsError = document.getElementById('add-points-error');
        const top10ListContainer = document.getElementById('top-10-list-container');
        const userInfo = document.getElementById('user-info');
        const clearDataButton = document.getElementById('clear-data-button');
        const clearDataModal = document.getElementById('clear-data-modal');

        // --- L∆ØU TR·ªÆ D·ªÆ LI·ªÜU V·ªöI FIRESTORE ---
        async function saveData() {
            try {
                await dataDocRef().set({ students: students });
            } catch (error) {
                console.error("L·ªói khi l∆∞u d·ªØ li·ªáu: ", error);
                alert("ƒê√£ c√≥ l·ªói x·∫£y ra khi l∆∞u d·ªØ li·ªáu.");
            }
        }

        function listenForDataChanges() {
            if (unsubscribe) unsubscribe();
            unsubscribe = dataDocRef().onSnapshot((doc) => {
                students = doc.exists ? (doc.data().students || []) : [];
                renderStudentList();
            }, (error) => {
                console.error("L·ªói khi l·∫Øng nghe d·ªØ li·ªáu:", error);
            });
        }

        // --- X√ÅC TH·ª∞C V√Ä ƒêI·ªÄU H∆Ø·ªöNG ---
        auth.onAuthStateChanged(user => {
            if (user) {
                const userData = predefinedUsers[user.email];
                if (userData) {
                    currentUserRole = userData.role;
                    currentUserGroupId = userData.groupId;
                    userInfo.innerHTML = `<strong>${user.email}</strong> [${currentUserRole}]`;
                }

                // Hi·ªÉn th·ªã n√∫t x√≥a d·ªØ li·ªáu n·∫øu l√† Admin
                if (currentUserRole === 'ADMIN') {
                    clearDataButton.classList.remove('hidden');
                } else {
                    clearDataButton.classList.add('hidden');
                }

                loginPage.classList.add('hidden');
                mainPage.classList.remove('hidden');
                listenForDataChanges();
            } else {
                if (unsubscribe) unsubscribe();
                students = [];
                currentUserRole = null;
                currentUserGroupId = null;
                renderStudentList();
                clearDataButton.classList.add('hidden'); // ·∫®n khi ƒëƒÉng xu·∫•t
                mainPage.classList.add('hidden');
                summaryPage.classList.add('hidden');
                loginPage.classList.remove('hidden');
            }
        });
        
        async function handleLogin() {
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password');
            const email = emailInput.value;
            const password = passwordInput.value;
            loginError.classList.add('hidden');

            if (!email || !password) {
                 loginError.textContent = "Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß email v√† m·∫≠t kh·∫©u.";
                 loginError.classList.remove('hidden');
                 return;
            }

            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                console.error("L·ªói ƒëƒÉng nh·∫≠p:", error);
                if (error.code === 'auth/wrong-password' || error.code === 'auth/user-not-found' || error.code === 'auth/invalid-credential') {
                     loginError.textContent = "T√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ch√≠nh x√°c.";
                } else {
                    loginError.textContent = `L·ªói: ${error.message}`;
                }
                loginError.classList.remove('hidden');
            }
        }
        
        async function handleLogout() {
            await auth.signOut();
        }

        // --- CH·ª®C NƒÇNG X√ìA D·ªÆ LI·ªÜU ---
        function openClearDataModal() {
            clearDataModal.classList.remove('hidden');
        }

        function closeClearDataModal() {
            clearDataModal.classList.add('hidden');
        }

        async function clearAllData() {
            const confirmBtn = document.getElementById('confirm-delete-btn');
            confirmBtn.disabled = true;
            confirmBtn.textContent = 'ƒêang x√≥a...';
            try {
                await dataDocRef().set({ students: [] });
                console.log("D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c x√≥a th√†nh c√¥ng.");
            } catch (error) {
                console.error("L·ªói khi x√≥a d·ªØ li·ªáu:", error);
                alert("ƒê√£ c√≥ l·ªói x·∫£y ra khi c·ªë g·∫Øng x√≥a d·ªØ li·ªáu.");
            } finally {
                confirmBtn.disabled = false;
                confirmBtn.textContent = 'X√°c nh·∫≠n X√≥a';
                closeClearDataModal();
            }
        }
        
        // --- C√ÅC H√ÄM X·ª¨ L√ù S·ª∞ KI·ªÜN CH√çNH ---
        async function addStudent() {
            const nameInput = document.getElementById('student-name');
            const name = nameInput.value.trim();

            addStudentError.classList.add('hidden');
            if (!name) {
                addStudentError.textContent = 'T√™n h·ªçc sinh kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.';
                addStudentError.classList.remove('hidden');
                return;
            }

            const existingIds = students.map(s => parseInt(s.id.replace('HS', ''), 10));
            const maxId = existingIds.length > 0 ? Math.max(...existingIds) : 0;
            const newId = `HS${maxId + 1}`;

            students.push({ id: newId, name, group: 0, score: 0 });

            nameInput.value = '';
            nameInput.focus();
            await saveData();
        }

        async function addPoints() {
            const studentIdInput = document.getElementById('student-id');
            const pointsInput = document.getElementById('points-to-add');
            const studentId = studentIdInput.value.trim().toUpperCase();
            const points = parseInt(pointsInput.value, 10);
            
            addPointsError.classList.add('hidden');
            if (!studentId || isNaN(points)) {
                addPointsError.textContent = 'Vui l√≤ng nh·∫≠p M√£ h·ªçc sinh v√† ƒêi·ªÉm c·ªông h·ª£p l·ªá.';
                addPointsError.classList.remove('hidden');
                return;
            }
            
            const student = students.find(s => s.id === studentId);
            if (!student) {
                addPointsError.textContent = `Kh√¥ng t√¨m th·∫•y h·ªçc sinh v·ªõi m√£ "${studentId}".`;
                addPointsError.classList.remove('hidden');
                return;
            }
            
            const isAdmin = currentUserRole === 'ADMIN';
            const canAddPoints = isAdmin || (student.group === currentUserGroupId);

            if (!canAddPoints) {
                 addPointsError.textContent = `B·∫°n kh√¥ng c√≥ quy·ªÅn c·ªông ƒëi·ªÉm cho h·ªçc sinh ·ªü T·ªï ${student.group}.`;
                 addPointsError.classList.remove('hidden');
                 return;
            }

            student.score += points;
            studentIdInput.value = '';
            pointsInput.value = '';
            await saveData();
        }
        
        // --- K√âO TH·∫¢ ---
        async function handleDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('drag-over');
            
            const studentId = event.dataTransfer.getData('text/plain');
            const newGroupId = parseInt(event.currentTarget.dataset.groupid, 10);
            
            const student = students.find(s => s.id === studentId);
            if (student && student.group !== newGroupId) {
                student.group = newGroupId;
                await saveData();
            }
        }

        function showSummary() {
            if (students.length === 0) {
                alert('Ch∆∞a c√≥ d·ªØ li·ªáu h·ªçc sinh ƒë·ªÉ t·ªïng k·∫øt.');
                return;
            }
            const sortedStudents = [...students].sort((a, b) => b.score - a.score);
            const top10 = sortedStudents.slice(0, 10);
            
            renderTop10List(top10);
            mainPage.classList.add('hidden');
            summaryPage.classList.remove('hidden');
        }

        function goBackToMain() {
            summaryPage.classList.add('hidden');
            mainPage.classList.remove('hidden');
        }

        function handleDragStart(event) {
            event.dataTransfer.setData('text/plain', event.target.id);
            setTimeout(() => { event.target.classList.add('dragging'); }, 0);
        }

        function handleDragEnd(event) {
            event.target.classList.remove('dragging');
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('drag-over');
        }

        function handleDragLeave(event) {
            event.currentTarget.classList.remove('drag-over');
        }
        
        document.querySelectorAll('.drop-zone').forEach(zone => {
            zone.addEventListener('dragover', handleDragOver);
            zone.addEventListener('dragleave', handleDragLeave);
            zone.addEventListener('drop', handleDrop);
        });
        
        // --- C√ÅC H√ÄM HI·ªÇN TH·ªä D·ªÆ LI·ªÜU (RENDER) ---
        function renderStudentList() {
            document.querySelectorAll('.student-card').forEach(card => card.remove());
            const unassignedZone = document.getElementById('unassigned-zone');
            const defaultMsg = unassignedZone.querySelector('p');

            students.forEach(student => {
                const studentCard = document.createElement('div');
                studentCard.id = student.id;
                studentCard.className = 'student-card p-2 bg-gray-100 rounded-md text-center border shadow-sm mt-2';
                studentCard.draggable = true;
                studentCard.innerHTML = `
                    <div class="font-bold text-gray-800 text-sm">${student.id}</div>
                    <div class="text-gray-600 text-xs truncate" title="${student.name}">${student.name}</div>
                    <div class="text-violet-600 font-semibold">${student.score}ƒë</div>
                `;
                studentCard.addEventListener('dragstart', handleDragStart);
                studentCard.addEventListener('dragend', handleDragEnd);

                const targetZone = document.querySelector(`.drop-zone[data-groupid="${student.group}"]`);
                if (targetZone) {
                    targetZone.appendChild(studentCard);
                }
            });

            if (unassignedZone.querySelectorAll('.student-card').length === 0) {
                 if (defaultMsg) defaultMsg.style.display = 'block';
            } else {
                 if (defaultMsg) defaultMsg.style.display = 'none';
            }
        }
        
        function renderTop10List(top10) {
            top10ListContainer.innerHTML = '';
            if (top10.length === 0) {
                top10ListContainer.innerHTML = '<p class="text-gray-500 text-center">Kh√¥ng c√≥ d·ªØ li·ªáu.</p>';
                return;
            }
            const medals = ['ü•á', 'ü•à', 'ü•â'];
            top10.forEach((student, index) => {
                const rankItem = document.createElement('div');
                rankItem.className = 'flex items-center p-4 rounded-lg border';
                let rankContent;
                if (index < 3) {
                     rankItem.className += ' bg-yellow-50 border-yellow-200';
                     rankContent = `<div class="text-3xl w-10 text-center">${medals[index]}</div>`;
                } else {
                     rankItem.className += ' bg-gray-50 border-gray-200';
                     rankContent = `<div class="text-xl font-bold text-gray-500 w-10 text-center">${index + 1}</div>`;
                }
                const groupText = student.group === 0 ? 'Ch∆∞a x·∫øp' : `T·ªï ${student.group}`;
                rankItem.innerHTML = `
                    ${rankContent}
                    <div class="ml-4 flex-grow">
                        <p class="font-bold text-gray-800 text-lg">${student.name}</p>
                        <p class="text-sm text-gray-500">${student.id} - ${groupText}</p>
                    </div>
                    <div class="text-xl font-bold text-violet-600">${student.score} ƒëi·ªÉm</div>
                `;
                top10ListContainer.appendChild(rankItem);
            });
        }
    </script>
</body>
</html>

